<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ei heilunu peitto, ei ollenkaan</title>
  <style>
    :root { --bg:#f6f7fb; --card:#ffffff; --text:#0b1220; --muted:#57607a; --line:#e6e8f0; --accent:#22c55e; }
    html, body { height:100%; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background: linear-gradient(180deg, #ffffff 0%, #f6f7fb 100%); color: var(--text); display:flex; align-items:center; justify-content:center; }
    .wrap { width: min(820px, 94vw); margin: 5vh auto; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: 18px; padding: clamp(18px, 4vw, 28px); box-shadow: 0 10px 30px rgba(15, 23, 42, .06); }
    .badge { display:inline-block; font-weight:700; background:#fff7cc; color:#7a6400; border:1px solid #f2e7a1; padding:8px 12px; border-radius:999px; margin-bottom:10px; }
    h1 { margin: 0 0 12px; font-size: clamp(24px, 3.6vw, 36px); line-height: 1.1; letter-spacing: -0.02em; }
    .choices { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; margin: 6px 0 12px; }
    .choice { appearance:none; border:1px solid var(--line); background:#ffffff; color:var(--text); padding:14px; border-radius:12px; font-size:18px; cursor:pointer; transition: transform .05s ease, border-color .15s ease, background .15s ease; }
    .choice:hover { border-color:#cdd3df; background:#fcfdff; }
    .choice:active { transform: translateY(1px); }
    .choice.is-selected { outline: 2px solid var(--accent); outline-offset: 2px; background: #f0fff4; border-color:#bfe9cc; }
    label { display:block; margin:10px 0 6px; color: var(--muted); font-size:14px; }
    textarea { width:100%; min-height: 110px; resize: vertical; padding:12px; border-radius:12px; border:1px solid var(--line); background:#ffffff; color:var(--text); font-size:16px; box-sizing:border-box; }
    textarea::placeholder{ color:#8a93a5; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:12px; }
    .btn { appearance:none; border:none; border-radius:12px; padding:12px 16px; font-size:16px; cursor:pointer; transition: filter .15s ease, transform .05s ease, box-shadow .15s ease; }
    .btn:active{ transform: translateY(1px); }
    .btn-primary { background: var(--accent); color:#052e12; font-weight: 700; box-shadow: 0 6px 18px rgba(34,197,94,.25); }
    .btn-primary:hover { filter: brightness(.98); }
    .btn-outline { background: transparent; border:1px solid var(--line); color: var(--muted); }
    .muted { color: var(--muted); }
    .hr { height:1px; background:var(--line); margin:18px 0; border-radius:1px; }
    .stats { display:flex; gap:12px; flex-wrap:wrap; }
    .pill { background:#ffffff; border:1px solid var(--line); padding:6px 10px; border-radius:999px; font-size:13px; color:var(--muted); }
    table { width:100%; border-collapse: collapse; margin-top: 6px; }
    th, td { padding:9px 6px; border-bottom:1px solid var(--line); text-align:left; font-size:14px; }
    th { color:#6b7280; font-weight:600; }
    .empty { padding:10px; border:1px dashed var(--line); color:#8a93a5; border-radius:12px; background:#ffffff; }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" aria-labelledby="otsikko">
      <div class="badge" aria-hidden="true">üí∂ Tonnin seteli</div>
      <h1 id="otsikko">Ei heilunu peitto, ei ollenkaan</h1>

      <div class="choices" role="group" aria-label="Vastausvaihtoehdot">
        <button class="choice" data-value="Ei A" aria-pressed="false">Ei</button>
        <button class="choice" data-value="Ei B" aria-pressed="false">Ei</button>
      </div>

      <label for="feedback" class="muted">Vapaa palaute (valinnainen)</label>
      <textarea id="feedback" placeholder="Kirjoita mit√§ mieless√§‚Ä¶"></textarea>

      <div class="row">
        <button id="submit" class="btn btn-primary">L√§het√§</button>
        <button id="clear" class="btn btn-outline" title="Tyhjenn√§ lomake">Tyhjenn√§</button>
      </div>

      <div class="hr"></div>

      <section aria-labelledby="tulokset-otsikko">
        <h2 id="tulokset-otsikko" style="margin:0 0 10px; font-size:20px">Vastaukset</h2>
        <div class="stats">
          <span class="pill" id="count-pill">Yhteens√§: 0</span>
          <span class="pill" id="a-pill">Ei (A): 0</span>
          <span class="pill" id="b-pill">Ei (B): 0</span>
        </div>
        <div id="table-wrap">
          <p class="empty" id="empty">Ei vastauksia viel√§. Ole ensimm√§inen!</p>
          <table id="results" hidden>
            <thead>
              <tr>
                <th>#</th>
                <th>Vastaus</th>
                <th>Palaute</th>
                <th>Aikaleima</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="row" style="margin-top:16px">
          <button id="export" class="btn btn-outline" title="Lataa CSV">Vie CSV</button>
          <button id="wipe" class="btn btn-outline" title="Poista kaikki tallennetut vastaukset">Tyhjenn√§ tallennetut</button>
        </div>
        <p class="muted" style="margin-top:8px">Huom: vastaukset tallentuvat vain t√§m√§n selaimen <code>localStorage</code>-muistiin. Jos haluat oikean tietokannan / pilvitallennuksen, sanon ohjeet tai lis√§√§n sen puolestasi.</p>
      </section>
    </section>
  </main>

  <script>
    (function(){
      const choices = Array.from(document.querySelectorAll('.choice'));
      const feedback = document.getElementById('feedback');
      const submit = document.getElementById('submit');
      const clearBtn = document.getElementById('clear');
      const wipeBtn = document.getElementById('wipe');
      const exportBtn = document.getElementById('export');

      const table = document.getElementById('results');
      const tbody = table.querySelector('tbody');
      const empty = document.getElementById('empty');

      const countPill = document.getElementById('count-pill');
      const aPill = document.getElementById('a-pill');
      const bPill = document.getElementById('b-pill');

      let selected = null;

      const KEY = 'ei-heilunu-peitto-vastaukset-v1';

      function load(){
        try { return JSON.parse(localStorage.getItem(KEY)) || []; }
        catch(e){ return []; }
      }
      function save(rows){ localStorage.setItem(KEY, JSON.stringify(rows)); }

      function render(){
        const rows = load();
        tbody.innerHTML = '';
        if(rows.length === 0){
          table.hidden = true; empty.hidden = false;
        } else {
          table.hidden = false; empty.hidden = true;
          rows.forEach((r,i)=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${i+1}</td><td>${r.answer}</td><td>${escapeHtml(r.feedback || '')}</td><td>${new Date(r.ts).toLocaleString()}</td>`;
            tbody.appendChild(tr);
          });
        }
        const a = rows.filter(r=>r.answer==='Ei A').length;
        const b = rows.filter(r=>r.answer==='Ei B').length;
        countPill.textContent = `Yhteens√§: ${rows.length}`;
        aPill.textContent = `Ei (A): ${a}`;
        bPill.textContent = `Ei (B): ${b}`;
      }

      function escapeHtml(s){
        return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',''':'&#39;'}[c]));
      }

      choices.forEach(btn=>{
        btn.addEventListener('click', ()=>{
          selected = btn.dataset.value;
          choices.forEach(b=>{
            const isSel = b===btn;
            b.classList.toggle('is-selected', isSel);
            b.setAttribute('aria-pressed', isSel ? 'true':'false');
          })
        })
      })

      submit.addEventListener('click', ()=>{
        if(!selected){
          alert('Valitse ensin jompikumpi: "Ei".');
          return;
        }
        const rows = load();
        rows.push({ answer: selected, feedback: feedback.value.trim(), ts: Date.now() });
        save(rows);
        feedback.value = '';
        choices.forEach(b=>{ b.classList.remove('is-selected'); b.setAttribute('aria-pressed','false'); });
        selected = null;
        render();
      })

      clearBtn.addEventListener('click', ()=>{
        feedback.value='';
        choices.forEach(b=>{ b.classList.remove('is-selected'); b.setAttribute('aria-pressed','false'); });
        selected=null;
      })

      wipeBtn.addEventListener('click', ()=>{
        if(confirm('Poistetaanko kaikki tallennetut vastaukset t√§st√§ selaimesta?')){
          save([]); render();
        }
      })

      exportBtn.addEventListener('click', ()=>{
        const rows = load();
        const header = ['index','answer','feedback','timestamp_iso'];
        const csv = [header.join(',')].concat(rows.map((r,i)=>[
          i+1,
          '"'+(r.answer||'').replaceAll('"','""')+'"',
          '"'+(r.feedback||'').replaceAll('"','""')+'"',
          new Date(r.ts).toISOString()
        ].join(','))).join('\n');
        const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'vastaukset.csv'; a.click();
        URL.revokeObjectURL(url);
      })

      render();
    })();
  </script>
</body>
</html>
